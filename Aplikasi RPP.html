<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APLIKASI RENCANA PELAKSANAAN PEMBELAJARAN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .running-text-container {
            background: linear-gradient(90deg, #059669, #10b981, #059669);
            color: white;
            padding: 12px 0;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .running-text {
            display: inline-block;
            white-space: nowrap;
            animation: runText 30s linear infinite;
            font-weight: 600;
            font-size: 1.1rem;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }
        @keyframes runText {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }
        .running-text:hover {
            animation-play-state: paused;
        }
        #output-area-print {
            font-family: 'Times New Roman', Times, serif;
            color: #000;
        }
        #output-area-print h1, #output-area-print h2, #output-area-print h3, #output-area-print h4 {
            color: #000;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #output-area, #output-area * {
                visibility: visible;
            }
            #output-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .running-text-container {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <!-- Running Text -->
        <div class="running-text-container">
            <div class="running-text">
                ðŸŽ“ SELAMAT DATANG DI APLIKASI RENCANA PELAKSANAAN PEMBELAJARAN (RPP) | 
                ðŸ’¡ MUDAH, CEPAT, DAN BERKUALITAS | 
                ðŸ“š UNTUK GURU MADRASAH | 
                ðŸŒŸ INTEGRASI KURIKULUM BERBASIS CINTA (KBC) DAN PEMBELAJARAN MENDALAM | 
                ðŸš€ FITUR CETAK PDF DAN WORD | 
                âœ¨ GRATIS DAN MUDAH DIGUNAKAN |
                ðŸŽ¯ HASIL PROFESIONAL DAN SESUAI STANDAR |
                ðŸŽ“ POKJAWASMAD KEMENAG KABUPATEN KUNINGAN |
            </div>
        </div>

        <header class="text-center mb-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg relative transition-colors duration-300">
            <h1 class="text-3xl md:text-4xl font-bold text-teal-700 dark:text-teal-400">APLIKASI RENCANA PELAKSANAAN PEMBELAJARAN (RPP)</h1>
            <p class="text-lg text-gray-600 dark:text-gray-400 mt-2">Oleh : Anang Maulana Pengawas Madrasah Kemenag Kabupaten Kuningan</p>
            <button id="theme-toggle" type="button" class="absolute top-4 right-4 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 011.414 0l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            </button>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-5 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg transition-colors duration-300">
                <h2 class="text-2xl font-semibold mb-6 border-b pb-3 text-teal-600 dark:text-teal-400 border-gray-200 dark:border-gray-700">Lengkapi Data RPP</h2>
                <form id="rpp-form" class="space-y-4">
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Nama Madrasah/Sekolah</label>
                        <input type="text" id="namaMadrasah" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: MTsN 1 Kuningan">
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Mata Pelajaran</label>
                        <input type="text" id="mataPelajaran" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: IPA">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Fase</label>
                            <input type="text" id="fase" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: D">
                        </div>
                        <div>
                            <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Kelas</label>
                            <input type="text" id="kelas" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: VIII">
                        </div>
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Tema</label>
                        <input type="text" id="tema" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: Pengenalan Sel">
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Profil Lulusan</label>
                        <input type="text" id="profilLulusan" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: Penalaran kritis; Kolaborasi">
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Topik KBC (Kurikulum Berbasis Cinta)</label>
                        <input type="text" id="topikKBC" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: Cinta Kepada Lingkungan">
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Tahun Ajaran</label>
                        <input type="text" id="tahunAjaran" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: 2025/2026">
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Materi Integrasi KBC</label>
                        <input type="text" id="materiIntegrasiKBC" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: Adab Pada Alam dan Lingkungan">
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Capaian Pembelajaran (CP)</label>
                        <textarea id="capaianPembelajaran" rows="4" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Tuliskan Capaian Pembelajaran di sini..."></textarea>
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Tujuan Pembelajaran (TP)</label>
                        <textarea id="tujuanPembelajaran" rows="4" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Tuliskan Tujuan Pembelajaran di sini..."></textarea>
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Praktek Pedagogik</label>
                        <textarea id="praktekPedagogik" rows="4" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: Diskusi kelompok, presentasi, studi kasus..."></textarea>
                    </div>
                    <div>
                        <label class="block text-md font-medium text-gray-700 dark:text-gray-300">Media dan Sumber Pembelajaran</label>
                        <textarea id="mediaSumberPembelajaran" rows="4" class="mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-teal-500 focus:border-teal-500 dark:text-white dark:placeholder-gray-400" placeholder="Contoh: Buku teks, video pembelajaran, alat peraga, lingkungan sekitar..."></textarea>
                    </div>

                    <button type="button" id="generate-btn" class="w-full bg-teal-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 transition-transform transform hover:scale-105">
                        Buat Rencana Pelaksanaan Pembelajaran
                    </button>
                </form>
            </div>

            <div class="lg:col-span-7">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg sticky top-8 transition-colors duration-300">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 border-b pb-3 border-gray-200 dark:border-gray-700">
                        <h2 class="text-2xl font-semibold text-teal-600 dark:text-teal-400 mb-2 sm:mb-0">Hasil RPP</h2>
                        <div id="action-buttons" class="hidden sm:flex space-x-3">
                            <button id="cetakWord" class="bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                                Cetak MS Word
                            </button>
                            <button id="cetakPdf" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                                Cetak PDF
                            </button>
                        </div>
                    </div>
                    <div id="output-container" class="mt-4 prose max-w-none prose-base dark:prose-invert">
                        <p class="text-gray-500 dark:text-gray-400 text-center py-10">Hasil RPP akan ditampilkan di sini setelah Anda melengkapi data dan menekan tombol 'Buat'.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // -- LOGIC MODE TERANG/GELAP --
            const themeToggleBtn = document.getElementById('theme-toggle');
            const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
            const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

            const applyTheme = () => {
                if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                    themeToggleLightIcon.classList.remove('hidden');
                    themeToggleDarkIcon.classList.add('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    themeToggleDarkIcon.classList.remove('hidden');
                    themeToggleLightIcon.classList.add('hidden');
                }
            };

            applyTheme();

            themeToggleBtn.addEventListener('click', function() {
                if (localStorage.getItem('color-theme')) {
                    if (localStorage.getItem('color-theme') === 'light') {
                        localStorage.setItem('color-theme', 'dark');
                    } else {
                        localStorage.setItem('color-theme', 'light');
                    }
                } else {
                    if (document.documentElement.classList.contains('dark')) {
                        localStorage.setItem('color-theme', 'light');
                    } else {
                        localStorage.setItem('color-theme', 'dark');
                    }
                }
                applyTheme();
            });

            // -- AKHIR LOGIC MODE TERANG/GELAP --

            // Mengambil elemen-elemen dari DOM
            const generateBtn = document.getElementById('generate-btn');
            const outputContainer = document.getElementById('output-container');
            const actionButtons = document.getElementById('action-buttons');
            const cetakPdfBtn = document.getElementById('cetakPdf');
            const cetakWordBtn = document.getElementById('cetakWord');

            function generateRPP() {
                const namaMadrasah = document.getElementById('namaMadrasah').value || '[Nama Madrasah Belum Diisi]';
                const mataPelajaran = document.getElementById('mataPelajaran').value || '[Mata Pelajaran Belum Diisi]';
                const fase = document.getElementById('fase').value || '[Fase Belum Diisi]';
                const kelas = document.getElementById('kelas').value || '[Kelas Belum Diisi]';
                const tema = document.getElementById('tema').value || '[Tema Belum Diisi]';
                const profilLulusan = document.getElementById('profilLulusan').value || '[Profil Lulusan Belum Diisi]';
                const topikKBC = document.getElementById('topikKBC').value || '[Topik KBC Belum Diisi]';
                const tahunAjaran = document.getElementById('tahunAjaran').value || '[Tahun Ajaran Belum Diisi]';
                const materiIntegrasiKBC = document.getElementById('materiIntegrasiKBC').value || `Menanamkan rasa empati, kepedulian sosial, dan tanggung jawab melalui implementasi materi ${tema}.`;
                const capaianPembelajaran = document.getElementById('capaianPembelajaran').value.replace(/\n/g, '<br>') || '[Capaian Pembelajaran Belum Diisi]';
                const tujuanPembelajaran = document.getElementById('tujuanPembelajaran').value.replace(/\n/g, '<br>') || '[Tujuan Pembelajaran Belum Diisi]';
                const praktekPedagogik = document.getElementById('praktekPedagogik').value.replace(/\n/g, '<br>') || '[Praktek Pedagogik Belum Diisi]';
                const mediaSumberPembelajaran = document.getElementById('mediaSumberPembelajaran').value.replace(/\n/g, '<br>') || `<ul style="list-style-type: disc; padding-left: 20px;">
                        <li>Buku Teks ${mataPelajaran} Kelas ${kelas}</li>
                        <li>Lembar Kerja Peserta Didik (LKPD)</li>
                        <li>Media presentasi (PowerPoint/Canva) tentang ${tema}</li>
                        <li>Video edukasi terkait ${tema}</li>
                        <li>Alat peraga dan bahan praktikum yang relevan</li>
                        <li>Lingkungan sekitar madrasah sebagai sumber belajar</li>
                        <li>Sumber digital: website edukasi, aplikasi pembelajaran</li>
                    </ul>`;

                // -- GENERATE DETAILED CONTENT --

                const langkahPembelajaranHTML = `
                    <p style="font-weight: bold; margin-bottom: 0.25rem;">a. Kegiatan Pendahuluan (15 Menit)</p>
                    <ul style="list-style-type: disc; padding-left: 20px; margin-bottom: 1rem;">
                        <li>Guru membuka pembelajaran dengan salam, menanyakan kabar, dan mengajak berdoa.</li>
                        <li>Guru memeriksa kehadiran peserta didik.</li>
                        <li>Apersepsi: Guru mengaitkan materi sebelumnya dengan materi yang akan dipelajari tentang <strong>${tema}</strong>.</li>
                        <li>Motivasi & Integrasi KBC: Guru mengajukan pertanyaan pemantik, "Bagaimana cara kita menunjukkan rasa cinta dan peduli kepada sesama?", untuk mengaitkan materi dengan <strong>${topikKBC}</strong>.</li>
                        <li>Guru menyampaikan tujuan pembelajaran yang akan dicapai.</li>
                    </ul>
                    <p style="font-weight: bold; margin-bottom: 0.25rem;">b. Kegiatan Inti (60 Menit)</p>
                    <ul style="list-style-type: disc; padding-left: 20px; margin-bottom: 1rem;">
                        <li><strong>Mengamati & Memahami:</strong> Peserta didik menyimak penjelasan guru mengenai konsep dasar <strong>${tema}</strong> melalui media presentasi atau video.</li>
                        <li><strong>Diskusi Kelompok (Integrasi KBC):</strong> Peserta didik dibagi menjadi beberapa kelompok untuk mendiskusikan studi kasus terkait penerapan <strong>${tema}</strong> dalam kehidupan.
                        Setiap kelompok ditugaskan untuk menganalisis bagaimana praktik tersebut mencerminkan nilai-nilai empati dan kepedulian sosial sesuai dengan <strong>${topikKBC}</strong>.</li>
                        <li><strong>Berkreasi:</strong> Setiap kelompok membuat rangkuman hasil diskusi dalam bentuk peta konsep atau infografis sederhana.</li>
                        <li><strong>Presentasi & Komunikasi:</strong> Setiap kelompok mempresentasikan hasil diskusinya. Kelompok lain memberikan tanggapan.
                        Guru memfasilitasi diskusi dan menekankan aspek cinta sesama dalam setiap presentasi.</li>
                    </ul>
                    <p style="font-weight: bold; margin-bottom: 0.25rem;">c. Kegiatan Penutup (15 Menit)</p>
                    <ul style="list-style-type: disc; padding-left: 20px; margin-bottom: 1rem;">
                        <li><strong>Refleksi (Integrasi KBC):</strong> Peserta didik bersama guru menyimpulkan pembelajaran dan melakukan refleksi tentang bagaimana materi <strong>${tema}</strong> dapat diimplementasikan sebagai wujud cinta kepada Allah SWT dan sesama manusia.</li>
                        <li>Guru memberikan umpan balik terhadap proses dan hasil pembelajaran.</li>
                        <li>Guru menginformasikan materi untuk pertemuan selanjutnya.</li>
                        <li>Pembelajaran ditutup dengan doa dan salam.</li>
                    </ul>
                `;

                const asesmenFormatifHTML = `
                    <h5 style="font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; font-size: 1.0rem;">Asesmen Formatif (Untuk mengukur penguasaan materi)</h5>
                    <p style="font-weight: bold; margin-bottom: 0.25rem;">1. Bentuk Instrumen: Tes Tulis (Uraian)</p>
                    <p style="font-weight: bold; margin-bottom: 0.25rem;">2. Soal Instrumen:</p>
                    <ol style="list-style-type: decimal; padding-left: 20px; margin-bottom: 1rem;">
                        <li>Jelaskan pengertian dan dasar hukum dari <strong>${tema}</strong>!</li>
                        <li>Analisislah, bagaimana penerapan <strong>${tema}</strong> dapat menjadi solusi untuk masalah sosial di sekitar Anda? Kaitkan jawabanmu dengan <strong>${topikKBC}</strong>!</li>
                        <li>Sebutkan dan jelaskan minimal 3 hikmah dari penerapan <strong>${tema}</strong> dalam kehidupan!</li>
                    </ol>
                    <p style="font-weight: bold; margin-bottom: 0.5rem;">3. Rubrik Penilaian Tes Tulis (Berdasarkan IKTP):</p>
                    <table style="width: 100%; border-collapse: collapse; border: 1px solid #000;">
                        <thead style="background-color: #f2f2f2;">
                            <tr>
                                <th style="border: 1px solid #000; padding: 8px; text-align: center;">No</th>
                                <th style="border: 1px solid #000; padding: 8px; text-align: left;">Indikator Ketercapaian Tujuan Pembelajaran (IKTP)</th>
                                <th style="border: 1px solid #000; padding: 8px; text-align: center;">Skor Maksimal</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center;">1</td>
                                <td style="border: 1px solid #000; padding: 8px;">Peserta didik mampu menjelaskan pengertian dan dasar hukum <strong>${tema}</strong> dengan benar dan lengkap.</td>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center;">30</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center;">2</td>
                                <td style="border: 1px solid #000; padding: 8px;">Peserta didik mampu menganalisis penerapan <strong>${tema}</strong> dan mengaitkannya dengan <strong>${topikKBC}</strong> secara logis.</td>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center;">40</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center;">3</td>
                                <td style="border: 1px solid #000; padding: 8px;">Peserta didik mampu menyebutkan dan menjelaskan hikmah dari <strong>${tema}</strong> secara relevan.</td>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center;">30</td>
                            </tr>
                            <tr>
                                <td colspan="2" style="border: 1px solid #000; padding: 8px; text-align: right; font-weight: bold;">Total Skor</td>
                                <td style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: bold;">100</td>
                            </tr>
                        </tbody>
                    </table>
                    <p style="margin-top: 0.5rem;"><i>Nilai Akhir = (Total Skor Perolehan / Total Skor Maksimal) * 100</i></p>
                `;

                const rubrikProfilHTML = `
                    <h5 style="font-weight: bold; margin-top: 1.5rem; margin-bottom: 0.5rem; font-size: 1.0rem;">Asesmen Non-Kognitif (Untuk mengukur Profil dan KBC)</h5>
                    <p style="margin-bottom: 0.5rem;">Rubrik ini digunakan untuk mengukur ketercapaian <strong>Profil Lulusan (${profilLulusan})</strong> dan penanaman nilai dari <strong>Topik KBC (${topikKBC})</strong> melalui observasi selama proses pembelajaran.</p>
                    <table style="width: 100%; border-collapse: collapse; border: 1px solid #000;">
                        <thead style="background-color: #f2f2f2;">
                            <tr>
                                <th rowspan="2" style="border: 1px solid #000; padding: 8px; text-align: center; vertical-align: middle;">Aspek yang Dinilai</th>
                                <th colspan="4" style="border: 1px solid #000; padding: 8px; text-align: center;">Tingkat Ketercapaian</th>
                            </tr>
                            <tr>
                                <th style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: normal;">Mulai Berkembang (MB)</th>
                                <th style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: normal;">Sedang Berkembang (SB)</th>
                                <th style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: normal;">Berkembang Sesuai Harapan (BSH)</th>
                                <th style="border: 1px solid #000; padding: 8px; text-align: center; font-weight: normal;">Sangat Berkembang (SAB)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="border: 1px solid #000; padding: 8px; font-weight: bold;">Profil: ${profilLulusan}</td>
                                <td style="border: 1px solid #000; padding: 8px;">Menunjukkan sedikit inisiatif dan masih perlu bimbingan untuk menerapkan nilai profil.</td>
                                <td style="border: 1px solid #000; padding: 8px;">Mulai menunjukkan inisiatif dengan sedikit bimbingan dalam menerapkan nilai profil.</td>
                                <td style="border: 1px solid #000; padding: 8px;">Mampu menerapkan nilai profil secara konsisten atas kesadaran sendiri.</td>
                                <td style="border: 1px solid #000; padding: 8px;">Mampu menerapkan nilai profil dan mengajak orang lain untuk melakukannya.</td>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #000; padding: 8px; font-weight: bold;">KBC: ${topikKBC}</td>
                                <td style="border: 1px solid #000; padding: 8px;">Mengetahui konsep kepedulian tetapi belum menunjukkannya dalam interaksi.</td>
                                <td style="border: 1px solid #000; padding: 8px;">Mulai menunjukkan sikap peduli dan empati kepada teman saat berdiskusi.</td>
                                <td style="border: 1px solid #000; padding: 8px;">Secara konsisten menunjukkan sikap peduli, empati, dan menghargai pendapat teman.</td>
                                <td style="border: 1px solid #000; padding: 8px;">Mampu mempromosikan dan menjadi teladan dalam sikap peduli dan empati di kelas.</td>
                            </tr>
                        </tbody>
                    </table>
                `;

                // --- Membuat template HTML untuk output ---
                const outputHTML = `
                    <div id="output-area">
                        <div id="output-area-print">
                            <h2 style="text-align: center; font-weight: bold; font-size: 1.25rem; margin-bottom: 0.5rem;">RENCANA PELAKSANAAN PEMBELAJARAN</h2>
                            <h3 style="text-align: center; font-weight: bold; font-size: 1.1rem; margin-bottom: 1.5rem;">'Integrasi Pembelajaran Mendalam dan Kurikulum Berbasis Cinta'</h3>

                            <h4 style="font-weight: bold; margin-bottom: 1rem; font-size: 1.1rem;">A. Identitas</h4>
                            <table style="width: 100%; border-collapse: collapse; margin-bottom: 1.5rem;">
                                <tr><td style="padding: 4px 0; vertical-align: top; width: 200px;">Nama Madrasah</td><td style="vertical-align: top; width: 10px;">:</td><td style="vertical-align: top;">${namaMadrasah}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Mata Pelajaran</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${mataPelajaran}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Fase/Kelas</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${fase} / ${kelas}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Tema</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${tema}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Tahun Ajaran</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${tahunAjaran}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Profil Pelajar</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${profilLulusan}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Topik KBC</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${topikKBC}</td></tr>
                                <tr><td style="padding: 4px 0; vertical-align: top;">Materi Integrasi KBC</td><td style="vertical-align: top;">:</td><td style="vertical-align: top;">${materiIntegrasiKBC}</td></tr>
                            </table>

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">B. Capaian Pembelajaran</h4>
                            <p style="margin-bottom: 1.5rem;">${capaianPembelajaran}</p>

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">C. Tujuan Pembelajaran</h4>
                            <p style="margin-bottom: 1.5rem;">${tujuanPembelajaran}</p>

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">D. Indikator Ketercapaian Tujuan Pembelajaran (IKTP)</h4>
                            <ul style="list-style-type: none; padding-left: 0; margin-bottom: 1.5rem;">
                                <li style="margin-bottom: 0.5rem;"><strong>1. Memahami:</strong> Peserta didik dapat menjelaskan konsep dasar dan dalil terkait <strong>${tema}</strong>.</li>
                                <li style="margin-bottom: 0.5rem;"><strong>2. Mengaplikasi:</strong> Peserta didik dapat mensimulasikan penerapan <strong>${tema}</strong> dalam konteks kehidupan sehari-hari.</li>
                                <li style="margin-bottom: 0.5rem;"><strong>3. Merefleksi:</strong> Peserta didik dapat merefleksikan nilai-nilai dari <strong>${topikKBC}</strong> yang terkandung dalam hikmah pembelajaran <strong>${tema}</strong>.</li>
                            </ul>

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">E. Praktek Pedagogik</h4>
                            <p style="margin-bottom: 1.5rem;">${praktekPedagogik}</p>

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">F. Komponen Inti</h4>
                            <ul style="list-style-position: inside; margin-left: 1rem; margin-bottom: 1.5rem;">
                                <li><strong>Lingkungan Belajar:</strong> Ruang kelas yang kondusif, perpustakaan, dan lingkungan madrasah yang mendukung pembelajaran kolaboratif.</li>
                                <li><strong>Mitra Pembelajaran:</strong> Kepala Madrasah, Sesama Guru Mata Pelajaran, dan Wali Murid.</li>
                                <li><strong>Pendekatan:</strong> Pendekatan Berbasis Proyek (Project-Based Learning) atau Inkuiri.</li>
                                <li><strong>Model Pembelajaran:</strong> Discovery Learning / Problem Based Learning (disesuaikan kebutuhan).</li>
                                <li><strong>Alokasi Waktu:</strong> 90 Menit (2 Jam Pelajaran).</li>
                            </ul>

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">G. Langkah-Langkah Pembelajaran (Skenario Utama)</h4>
                            ${langkahPembelajaranHTML}

                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">H. Asesmen Pembelajaran</h4>
                            ${asesmenFormatifHTML}
                            ${rubrikProfilHTML}

                            <!-- BAGIAN MEDIA DAN SUMBER PEMBELAJARAN DI URUTAN TERAKHIR -->
                            <h4 style="font-weight: bold; margin-bottom: 0.5rem; font-size: 1.1rem;">I. Media dan Sumber Pembelajaran</h4>
                            <p style="margin-bottom: 1.5rem;">${mediaSumberPembelajaran}</p>

                        </div>
                    </div>
                `;

                // Tampilkan hasil dan tombol aksi
                outputContainer.innerHTML = outputHTML;
                actionButtons.classList.remove('hidden');
                
                // Scroll ke bagian output
                outputContainer.scrollIntoView({ behavior: 'smooth' });
            }

            // Event listener untuk tombol Generate
            generateBtn.addEventListener('click', generateRPP);

            // --- LOGIC CETAK KE PDF ---
            cetakPdfBtn.addEventListener('click', function () {
                const outputArea = document.getElementById('output-area');
                
                // Cek apakah ada konten yang digenerate
                if (outputArea) {
                    const firstP = outputArea.querySelector('p');
                    if(firstP && firstP.textContent.includes('ditampilkan di sini')) {
                        alert("Silakan buat Rencana Pembelajaran terlebih dahulu.");
                        return;
                    }
                }

                const outputAreaPrint = document.getElementById('output-area-print');
                
                // Gunakan html2canvas untuk menangkap konten
                html2canvas(outputAreaPrint, { 
                    scale: 2, 
                    useCORS: true,
                    // Pastikan warna teks dan latar belakang diatur untuk cetak
                    onclone: (doc) => {
                        doc.getElementById('output-area-print').style.backgroundColor = 'white';
                        doc.getElementById('output-area-print').style.color = 'black';
                    }
                }).then(canvas => {
                    const { jsPDF } = window.jspdf;
                    // Ukuran A4 dalam milimeter (210 x 297 mm)
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const imgWidth = 210; 
                    const pageHeight = 297;  
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 0;

                    // Tambahkan setiap bagian gambar sebagai halaman PDF
                    pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
                        heightLeft -= pageHeight;
                    }

                    // Simpan PDF
                    pdf.save(`RPP-${document.getElementById('tema').value || 'Rencana Pelaksanaan Pembelajaran'}-${document.getElementById('tahunAjaran').value || 'Tahun-Ajaran'}.pdf`);
                }).catch(error => {
                    console.error('PDF generation failed:', error);
                    alert('Gagal membuat PDF. Cek konsol untuk detail.');
                });
            });

            // --- LOGIC CETAK KE WORD ---
            cetakWordBtn.addEventListener('click', function () {
                const outputArea = document.getElementById('output-area');
                
                // Cek apakah ada konten yang digenerate
                if (outputArea) {
                    const firstP = outputArea.querySelector('p');
                    if(firstP && firstP.textContent.includes('ditampilkan di sini')) {
                        alert("Silakan buat Rencana Pembelajaran terlebih dahulu.");
                        return;
                    }
                }

                const content = document.getElementById('output-area-print').innerHTML;
                
                const header = "<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>Export HTML to Word Document</title></head><body>";
                const footer = "</body></html>";
                
                const html = header + content + footer;

                const blob = new Blob(['\ufeff', html], {
                    type: 'application/msword'
                });

                // Membuat nama file
                const filename = `RPP-${document.getElementById('tema').value || 'Rencana Pelaksanaan Pembelajaran'}-${document.getElementById('tahunAjaran').value || 'Tahun-Ajaran'}.doc`;

                // Membuat link unduhan dan mensimulasikan klik
                const downloadLink = document.createElement("a");
                document.body.appendChild(downloadLink);
                
                // Cek support untuk IE/Edge
                if(navigator.msSaveOrOpenBlob) {
                    navigator.msSaveOrOpenBlob(blob, filename);
                } else {
                    downloadLink.href = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(html);
                    downloadLink.download = filename;
                    downloadLink.click();
                }

                document.body.removeChild(downloadLink);
            });

        });
    </script>
</body>
</html>